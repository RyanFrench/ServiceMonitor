#!/usr/bin/env ruby

#Add the currently running directory to the start of the load path
$:.unshift './'

require 'net/smtp'
require "Alert"
require "Alert/Email"
require "MonitorType"
require "MonitorType/Threshold"
require "MonitorType/Beanstalk"
require "MonitorType/Dir"
require "MonitorType/FluidDb"
require "MonitorManager"

def log( string, verbose=false )
	if !ENV["VERBOSE"].nil? || verbose==false then
		puts string
	end
end

if ARGV.length == 1 then
        dslName = ARGV[0]
else
        abort( "Usage: monitor <path to dsl>" )
end


$a = MonitorManager.new

log "Loading dsl, #{dslName}"
begin
load dslName
$a.run
rescue ArgumentError=>e
    puts "*** Your dsl is not formatted correctly"
    puts "*** Ensure each line has the format,"
    puts "***   <command>, [:arg=>value]"
rescue SystemExit=>e
rescue Exception=>e
    puts e.class.name
    puts e.message
end

